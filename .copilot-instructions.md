# Budget App - GitHub Copilot Instructions

> **ü§ñ ATEN√á√ÉO**: Este arquivo √© automaticamente carregado pelo GitHub Copilot no VS Code.
> Todas as instru√ß√µes aqui s√£o seguidas automaticamente sem necessidade de refer√™ncia manual.

## üéØ Arquitetura e Stack Tecnol√≥gico

- **Architecture**: Budget-centric design (all entities belong to a budget)
- **Tech Stack**: React + TypeScript + Node.js + PostgreSQL + Prisma
- **Deploy**: Render (Docker + Static Site) + Supabase PostgreSQL
- **Auth System**: JWT with budget-level permissions (READ/WRITE/OWNER)
- **Primary Context**: `.github/copilot/copilot-context.md` (documenta√ß√£o completa)

## üö® REGRAS OBRIGAT√ìRIAS PARA QUALQUER ALTERA√á√ÉO

[!IMPORTANT]

### üåê Ambiente de Produ√ß√£o

- **Deploy em produ√ß√£o**: Render (Docker backend + Static Site frontend)
- **Database em produ√ß√£o**: Supabase PostgreSQL (gratuito)
- **URLs de produ√ß√£o**:
  - Frontend: https://budget-app-docker-client.onrender.com
  - Backend: https://budget-app-docker-server.onrender.com
- **Custo total**: $0/m√™s

### üê≥ Ambiente de Desenvolvimento

- **Todo desenvolvimento e testes devem ser realizados em containers Docker**. Utilize sempre o `docker-compose.yml` para subir cliente, servidor e banco de dados.
- **Scripts, comandos e exemplos devem assumir que os servi√ßos est√£o rodando em containers.**

### üë§ Usu√°rios de Teste Padr√£o

- Utilize sempre os seguintes usu√°rios para testes automatizados e exemplos:
  - joao@example.com
  - maria@example.com
  - pedro@example.com
- Senha padr√£o para todos: `123456`

### üß™ Testes de Importa√ß√£o de Extratos

- **OBRIGAT√ìRIO**: Para testar importa√ß√£o de extratos banc√°rios, SEMPRE use o script automatizado existente
- **Comando**: `./test-import-extratos.sh` (executar da raiz do projeto)
- **N√ÉO recriar** scripts de teste similares - o script existente √© completo e otimizado
- **Caracter√≠sticas do script:**
  - ‚úÖ Testa 19 arquivos de diferentes bancos (BTG, Bradesco, C6, Clear, Inter, Ita√∫, Nubank, XP)
  - ‚úÖ Zero depend√™ncias externas (usa APIs nativas Node.js 18+)
  - ‚úÖ Configura automaticamente dados de desenvolvimento (seed)
  - ‚úÖ Relat√≥rio detalhado com estat√≠sticas por banco
  - ‚úÖ Valida√ß√£o completa do fluxo de importa√ß√£o via API
- **Uso em desenvolvimento**: Execute antes e depois de altera√ß√µes nos parsers de importa√ß√£o
- **Arquivos do sistema**: `test-import-extratos.js` + `test-import-extratos.sh`

### üì¶ Versionamento Sem√¢ntico

- **OBRIGAT√ìRIO**: Os arquivos `package.json` do client e server devem sempre refletir o versionamento sem√¢ntico de 3 n√≠veis: **MAJOR.MINOR.PATCH**
- **Estrutura**: `"version": "X.Y.Z"` onde:
  - **MAJOR** (X): Mudan√ßas incompat√≠veis na API ou breaking changes
  - **MINOR** (Y): Novas funcionalidades mantendo compatibilidade
  - **PATCH** (Z): Corre√ß√µes de bugs e pequenas melhorias
- **Sincroniza√ß√£o**: Client e server devem sempre ter a mesma vers√£o
- **Atualiza√ß√£o**: Incrementar vers√£o em ambos os package.json simultaneamente
- **Exemplo**: `"version": "1.2.3"`

### üìã **PROTOCOLO PR√â-DESENVOLVIMENTO**

1. **SEMPRE consulte `.github/copilot/copilot-context.md`** - Fonte √∫nica de verdade
2. **Leia `.github/copilot/instructions/development-rules.md`** - Regras t√©cnicas
3. **Use `.github/copilot/instructions/development-checklist.md`** - Checklist completo
4. **Verifique padr√µes de responsividade** - Mobile-first obrigat√≥rio
5. **Considere sistema de compartilhamento** - Or√ßamentos compartilhados obrigat√≥rio
6. **Valide permiss√µes** - READ vs WRITE em or√ßamentos compartilhados
7. **Mantenha isolamento por or√ßamento** - Dados nunca podem vazar entre or√ßamentos

### üõ†Ô∏è **DURANTE O DESENVOLVIMENTO**

#### **Responsividade (OBRIGAT√ìRIO)**

- **Container padr√£o**: `max-w-7xl mx-auto px-4 sm:px-6 lg:px-8`
- **Breakpoints**: mobile(<768px), tablet(768-1024px), desktop(>1024px)
- **Design mobile-first** sempre
- **Grid/flex responsivo** apropriado

#### **Sistema de Compartilhamento (OBRIGAT√ìRIO)**

- **Props obrigat√≥rias**: `budgetId?: string` em componentes
- **Rotas duplas**: `/api/resource` e `/api/budgets/:budgetId/resource`
- **Banner informativo** para or√ßamentos compartilhados
- **Verifica√ß√£o de permiss√µes**: READ/WRITE/OWNER
- **Desabilitar funcionalidades** para usu√°rios READ-only
- **Usar BudgetContext**: `activeBudget?.budgetId`

#### **Seguran√ßa e Isolamento (CR√çTICO)**

- **Middleware obrigat√≥rio**: `auth`, `budgetAuth`, `requireWritePermission`
- **Filtros por or√ßamento** em todas as consultas SQL
- **Valida√ß√£o de entidades** pertencentes ao or√ßamento correto
- **TypeScript estrito** - sem `any` types
- **Tratamento de erros** apropriado
- **Valida√ß√£o de dados** com Joi/Zod

#### **Testes de Importa√ß√£o (OBRIGAT√ìRIO)**

- **Quando modificar parsers de importa√ß√£o**: SEMPRE execute `./test-import-extratos.sh`
- **Antes de commits**: Valide se as importa√ß√µes continuam funcionando
- **N√ÉO criar novos scripts**: Use apenas o script existente e otimizado
- **Em caso de falhas**: Analise o relat√≥rio detalhado gerado pelo script
- **Cobertura**: O script testa automaticamente 19 arquivos de 8 bancos diferentes

### üîÑ **P√ìS-DESENVOLVIMENTO (OBRIGAT√ìRIO)**

1. **CRITICAL: Atualizar `.github/copilot/copilot-context.md`** com mudan√ßas
2. **Documentar novas funcionalidades** na se√ß√£o apropriada
3. **Adicionar exemplos de c√≥digo** se necess√°rio
4. **Registrar data da atualiza√ß√£o** no final do arquivo
5. **Testar responsividade** (mobile, tablet, desktop)
6. **Testar compartilhamento** com permiss√µes READ e WRITE
7. **IMPORTA√á√ïES: Executar `./test-import-extratos.sh`** se modificou parsers de importa√ß√£o

## üèóÔ∏è **ARQUITETURA BUDGET-CENTRIC**

### **Princ√≠pios Fundamentais**

1. **Tudo pertence a um or√ßamento** - Nunca criar entidades √≥rf√£s
2. **Isolamento total** - Dados de or√ßamentos diferentes nunca se misturam
3. **Permiss√µes granulares** - READ/WRITE respeitadas em toda interface
4. **Valida√ß√£o multicamada** - Frontend + Middleware + Controller + Database

### **Padr√µes de API**

```typescript
// Or√ßamento pr√≥prio
GET /api/accounts
POST /api/transactions

// Or√ßamento compartilhado
GET /api/budgets/:budgetId/accounts
POST /api/budgets/:budgetId/transactions
```

### **Padr√µes de Interface**

```typescript
// Sempre verificar permiss√µes
const { activeBudget, isOwner } = useBudget();
const hasWritePermission =
  activeBudget?.permission === "WRITE" || activeBudget?.permission === "OWNER";
```

## üß∞ Templates Dispon√≠veis

- `budget-route` - Express route with auth middleware
- `budget-component` - React component template
- `budget-model` - Prisma model template
- `budget-service` - API service template

## üìÅ Arquivos de Contexto Detalhado

- **`.github/copilot/copilot-context.md`** - Documenta√ß√£o completa (1700+ linhas)
- **`.github/copilot/copilot-examples.md`** - Exemplos pr√°ticos
- **`.github/copilot/copilot-config.md`** - Configura√ß√µes e snippets
- **`.github/copilot/instructions/`** - Regras e checklists espec√≠ficos

---

**‚ö° LEMBRE-SE**: Este arquivo garante que o GitHub Copilot siga automaticamente todas as diretrizes do projeto Budget App sem necessidade de refer√™ncia manual.
