# Budget App - GitHub Copilot Instructions

> **ü§ñ ATEN√á√ÉO**: Este arquivo √© automaticamente carregado pelo GitHub Copilot no VS Code.
> Todas as instru√ß√µes aqui s√£o seguidas automaticamente sem necessidade de refer√™ncia manual.

## üìö Estrutura de Documenta√ß√£o (IMPORTANTE)

**Consulte os arquivos AGENTS.md espec√≠ficos para instru√ß√µes detalhadas por escopo:**

- **`/AGENTS.md`** - Vis√£o geral do projeto, arquitetura, princ√≠pios fundamentais, workflows comuns
- **`/client/AGENTS.md`** - Instru√ß√µes espec√≠ficas do frontend (React, TypeScript, Tailwind, componentes)
- **`/server/AGENTS.md`** - Instru√ß√µes espec√≠ficas do backend (Express, Prisma, APIs, middleware)

**Documenta√ß√£o complementar em `.github/copilot/`:**

- **`copilot-context.md`** - Fonte √∫nica de verdade com documenta√ß√£o completa (2900+ linhas)
- **`copilot-examples.md`** - Exemplos pr√°ticos de implementa√ß√£o
- **`instructions/development-rules.md`** - Regras t√©cnicas obrigat√≥rias
- **`instructions/development-checklist.md`** - Checklist completo para altera√ß√µes

## üéØ Arquitetura e Stack Tecnol√≥gico

- **Architecture**: Budget-centric design (all entities belong to a budget)
- **Tech Stack**: React + TypeScript + Node.js + PostgreSQL + Prisma
- **Deploy**: Render (Docker + Static Site) + Supabase PostgreSQL
- **Auth System**: JWT with budget-level permissions (READ/WRITE/OWNER)

## üö® REGRAS OBRIGAT√ìRIAS PARA QUALQUER ALTERA√á√ÉO

[!IMPORTANT]

### üåê Ambiente de Produ√ß√£o

- **Deploy em produ√ß√£o**: Render (Docker backend + Static Site frontend)
- **Database em produ√ß√£o**: Supabase PostgreSQL (gratuito)
- **URLs de produ√ß√£o**:
  - Frontend: https://budget-app-docker-client.onrender.com
  - Backend: https://budget-app-docker-server.onrender.com
- **Custo total**: $0/m√™s

### üê≥ Ambiente de Desenvolvimento

- **Todo desenvolvimento e testes devem ser realizados em containers Docker**. Utilize sempre o `docker-compose.yml` para subir cliente, servidor e banco de dados.
- **Scripts, comandos e exemplos devem assumir que os servi√ßos est√£o rodando em containers.**

### üë§ Usu√°rios de Teste Padr√£o

- Utilize sempre os seguintes usu√°rios para testes automatizados e exemplos:
  - joao@example.com
  - maria@example.com
  - pedro@example.com
- Senha padr√£o para todos: `123456`

### üß™ Testes de Importa√ß√£o de Extratos

- **OBRIGAT√ìRIO**: Para testar importa√ß√£o de extratos banc√°rios, SEMPRE use o script automatizado existente
- **Comando**: `./test-import-extratos.sh` (executar da raiz do projeto)
- **N√ÉO recriar** scripts de teste similares - o script existente √© completo e otimizado
- **Caracter√≠sticas do script:**
  - ‚úÖ Testa 19 arquivos de diferentes bancos (BTG, Bradesco, C6, Clear, Inter, Ita√∫, Nubank, XP)
  - ‚úÖ Zero depend√™ncias externas (usa APIs nativas Node.js 18+)
  - ‚úÖ Configura automaticamente dados de desenvolvimento (seed)
  - ‚úÖ Relat√≥rio detalhado com estat√≠sticas por banco
  - ‚úÖ Valida√ß√£o completa do fluxo de importa√ß√£o via API
- **Uso em desenvolvimento**: Execute antes e depois de altera√ß√µes nos parsers de importa√ß√£o
- **Arquivos do sistema**: `test-import-extratos.js` + `test-import-extratos.sh`

### üì¶ Versionamento Sem√¢ntico

- **OBRIGAT√ìRIO**: Os arquivos `package.json` do client e server devem sempre refletir o versionamento sem√¢ntico de 3 n√≠veis: **MAJOR.MINOR.PATCH**
- **Estrutura**: `"version": "X.Y.Z"` onde:
  - **MAJOR** (X): Mudan√ßas incompat√≠veis na API ou breaking changes
  - **MINOR** (Y): Novas funcionalidades mantendo compatibilidade
  - **PATCH** (Z): Corre√ß√µes de bugs e pequenas melhorias
- **Sincroniza√ß√£o**: Client e server devem sempre ter a mesma vers√£o
- **Atualiza√ß√£o**: Incrementar vers√£o em ambos os package.json simultaneamente
- **Exemplo**: `"version": "1.2.3"`

### üìã **PROTOCOLO PR√â-DESENVOLVIMENTO**

**IMPORTANTE: Consulte os arquivos AGENTS.md apropriados primeiro:**

1. **Se trabalhando no frontend**: Leia `/client/AGENTS.md` para padr√µes espec√≠ficos
2. **Se trabalhando no backend**: Leia `/server/AGENTS.md` para padr√µes espec√≠ficos
3. **Para contexto geral**: Consulte `/AGENTS.md` para princ√≠pios e arquitetura
4. **Para detalhes completos**: `.github/copilot/copilot-context.md` √© a fonte √∫nica de verdade
5. **Para regras t√©cnicas**: `.github/copilot/instructions/development-rules.md`
6. **Para checklist**: `.github/copilot/instructions/development-checklist.md`

**Princ√≠pios obrigat√≥rios:**

- ‚úÖ Responsividade mobile-first
- ‚úÖ Suporte a or√ßamentos compartilhados
- ‚úÖ Valida√ß√£o de permiss√µes (READ/WRITE)
- ‚úÖ Isolamento por or√ßamento
- ‚ùå **N√ÉO criar arquivos de documenta√ß√£o/resumo** (CHANGES.md, SUMMARY.md, etc.)

### üõ†Ô∏è **DURANTE O DESENVOLVIMENTO**

#### **Documenta√ß√£o (CR√çTICO)**

- **‚ùå N√ÉO CRIAR**: Arquivos como `IMPLEMENTATION_SUMMARY.md`, `CHANGES.md`, `FEATURE_*.md`, `STATUS_*.md`
- **‚úÖ ATUALIZAR**: O AGENTS.md relevante (root/client/server), copilot-context.md e c√≥digo
- **‚úÖ COMENT√ÅRIOS**: Adicione inline comments para l√≥gica complexa
- **‚úÖ README**: Atualize apenas se√ß√µes existentes quando apropriado

#### **Responsividade (OBRIGAT√ìRIO)**

- **Container padr√£o**: `max-w-7xl mx-auto px-4 sm:px-6 lg:px-8`
- **Breakpoints**: mobile(<768px), tablet(768-1024px), desktop(>1024px)
- **Design mobile-first** sempre
- **Grid/flex responsivo** apropriado

#### **Sistema de Compartilhamento (OBRIGAT√ìRIO)**

- **Props obrigat√≥rias**: `budgetId?: string` em componentes
- **Rotas duplas**: `/api/resource` e `/api/budgets/:budgetId/resource`
- **Banner informativo** para or√ßamentos compartilhados
- **Verifica√ß√£o de permiss√µes**: READ/WRITE/OWNER
- **Desabilitar funcionalidades** para usu√°rios READ-only
- **Usar BudgetContext**: `activeBudget?.budgetId`

#### **Seguran√ßa e Isolamento (CR√çTICO)**

- **Middleware obrigat√≥rio**: `auth`, `budgetAuth`, `requireWritePermission`
- **Filtros por or√ßamento** em todas as consultas SQL
- **Valida√ß√£o de entidades** pertencentes ao or√ßamento correto
- **TypeScript estrito** - sem `any` types
- **Tratamento de erros** apropriado
- **Valida√ß√£o de dados** com Joi/Zod

#### **Testes de Importa√ß√£o (OBRIGAT√ìRIO)**

- **Quando modificar parsers de importa√ß√£o**: SEMPRE execute `./test-import-extratos.sh`
- **Antes de commits**: Valide se as importa√ß√µes continuam funcionando
- **N√ÉO criar novos scripts**: Use apenas o script existente e otimizado
- **Em caso de falhas**: Analise o relat√≥rio detalhado gerado pelo script
- **Cobertura**: O script testa automaticamente 19 arquivos de 8 bancos diferentes

### üîÑ **P√ìS-DESENVOLVIMENTO (OBRIGAT√ìRIO)**

**Atualize a documenta√ß√£o ap√≥s qualquer altera√ß√£o:**

1. **Atualize o AGENTS.md apropriado**:
   - `/AGENTS.md` - Para mudan√ßas arquiteturais ou princ√≠pios gerais
   - `/client/AGENTS.md` - Para novos padr√µes ou componentes frontend
   - `/server/AGENTS.md` - Para novos padr√µes ou rotas backend
2. **CR√çTICO: Atualize `.github/copilot/copilot-context.md`** com mudan√ßas detalhadas
3. **Documente novas funcionalidades** na se√ß√£o apropriada
4. **Adicione exemplos de c√≥digo** em `copilot-examples.md` se relevante
5. **Registre data da atualiza√ß√£o** no final dos arquivos modificados
6. **Teste responsividade** em todos os breakpoints (mobile, tablet, desktop)
7. **Teste compartilhamento** com permiss√µes READ e WRITE
8. **Se modificou parsers de importa√ß√£o**: Execute `./test-import-extratos.sh`

## üèóÔ∏è **ARQUITETURA BUDGET-CENTRIC**

### **Princ√≠pios Fundamentais**

1. **Tudo pertence a um or√ßamento** - Nunca criar entidades √≥rf√£s
2. **Isolamento total** - Dados de or√ßamentos diferentes nunca se misturam
3. **Permiss√µes granulares** - READ/WRITE respeitadas em toda interface
4. **Valida√ß√£o multicamada** - Frontend + Middleware + Controller + Database

### **Padr√µes de API**

```typescript
// Or√ßamento pr√≥prio
GET /api/accounts
POST /api/transactions

// Or√ßamento compartilhado
GET /api/budgets/:budgetId/accounts
POST /api/budgets/:budgetId/transactions
```

### **Padr√µes de Interface**

```typescript
// Sempre verificar permiss√µes
const { activeBudget, isOwner } = useBudget();
const hasWritePermission =
  activeBudget?.permission === "WRITE" || activeBudget?.permission === "OWNER";
```

## üß∞ Recursos Dispon√≠veis

### Templates de C√≥digo

- `budget-route` - Express route with auth middleware
- `budget-component` - React component template
- `budget-model` - Prisma model template
- `budget-service` - API service template

### Arquivos de Refer√™ncia R√°pida

- **`/AGENTS.md`** - Overview do projeto, arquitetura, princ√≠pios
- **`/client/AGENTS.md`** - Padr√µes frontend, componentes, styling
- **`/server/AGENTS.md`** - Padr√µes backend, APIs, middleware

### Documenta√ß√£o Detalhada

- **`.github/copilot/copilot-context.md`** - Fonte √∫nica de verdade (2900+ linhas)
- **`.github/copilot/copilot-examples.md`** - Exemplos pr√°ticos completos
- **`.github/copilot/instructions/development-rules.md`** - Regras t√©cnicas
- **`.github/copilot/instructions/development-checklist.md`** - Checklist completo

---

**‚ö° FLUXO RECOMENDADO**:

1. Consulte o AGENTS.md do diret√≥rio em que est√° trabalhando
2. Para detalhes completos, veja copilot-context.md
3. Para exemplos pr√°ticos, consulte copilot-examples.md
4. Antes de commits, verifique development-checklist.md

**√öltima atualiza√ß√£o**: 12 de Novembro 2025 - Implementa√ß√£o da estrutura AGENTS.md seguindo VS Code best practices

---

**‚ö° LEMBRE-SE**: Este arquivo garante que o GitHub Copilot siga automaticamente todas as diretrizes do projeto Budget App sem necessidade de refer√™ncia manual.
